<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Foto's Delen</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header><h1>Foto's Delen</h1></header>
    <main>
        <section class="upload-section">
            <h2>Upload je foto's</h2>
            <form id="uploadForm">
                <label>Selecteer foto's: <input type="file" id="fileInput" name="fotos" multiple accept="image/*" required></label>
                <label>Beschrijving: <textarea id="beschrijving" name="beschrijving" placeholder="Vertel iets over deze foto's"></textarea></label>
                <label>Jaar van de foto's: <input type="number" id="jaar" name="jaar" min="1900" max="2024"></label>
                <button type="submit">Uploaden</button>
            </form>
            <div id="uploadStatus" style="margin-top: 10px; padding: 10px; border-radius: 4px;"></div>
        </section>

        <section class="photo-gallery">
            <h2>Gedeelde Foto's</h2>
            <div class="photo-grid" id="photoGrid">
                <!-- Geüploade foto's verschijnen hier -->
            </div>
        </section>
    </main>
    <script>
    const cloudName = 'dumispo3z';
    const uploadPreset = 'familie_reunie_felix'; // Let op: geen umlaut in de code
    const uploadForm = document.getElementById('uploadForm');
    const fileInput = document.getElementById('fileInput');
    const beschrijvingInput = document.getElementById('beschrijving');
    const jaarInput = document.getElementById('jaar');
    const uploadStatus = document.getElementById('uploadStatus');
    const photoGrid = document.getElementById('photoGrid');

    uploadForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const files = fileInput.files;
        
        if (!files.length) {
            showStatus('Selecteer eerst een foto', 'error');
            return;
        }

        showStatus('Uploaden...', 'info');
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', uploadPreset);
            
            try {
                const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Upload response:', data); // Debug logging
                
                if (data.secure_url) {
                    addPhotoToGrid(data.secure_url, beschrijvingInput.value, jaarInput.value);
                    showStatus(`Foto ${i + 1} van ${files.length} succesvol geüpload!`, 'success');
                } else {
                    throw new Error('Geen URL ontvangen van Cloudinary');
                }
            } catch (err) {
                console.error('Upload error:', err); // Debug logging
                showStatus(`Fout bij uploaden van foto ${i + 1}: ${err.message}`, 'error');
            }
        }
        
        uploadForm.reset();
    });

    function showStatus(message, type) {
        uploadStatus.textContent = message;
        uploadStatus.style.backgroundColor = type === 'error' ? '#ffebee' : 
                                          type === 'success' ? '#e8f5e9' : 
                                          '#e3f2fd';
        uploadStatus.style.color = type === 'error' ? '#c62828' : 
                                 type === 'success' ? '#2e7d32' : 
                                 '#1565c0';
    }

    function addPhotoToGrid(url, beschrijving, jaar) {
        const div = document.createElement('div');
        div.className = 'photo-item';
        div.innerHTML = `
            <img src="${url}" alt="Familiefoto" style="width: 100%; height: auto;">
            <p>${beschrijving ? beschrijving : ''}</p>
            <p>${jaar ? 'Jaar: ' + jaar : ''}</p>
        `;
        photoGrid.prepend(div);
    }
    </script>
</body>
</html>